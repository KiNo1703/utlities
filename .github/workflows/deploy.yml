name: üöÄ Deploy to Alpine Server

# –ó–∞–ø—É—Å–∫–∞—Ç—å workflow –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø—É—à–µ –≤ –≤–µ—Ç–∫—É main
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π Ubuntu (—Å—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è GitHub Actions)
    runs-on: ubuntu-latest

    steps:
      # –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      - name: ‚¨áÔ∏è Checkout code
        uses: actions/checkout@v4

      # –®–∞–≥ 2: –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ SSH
      - name: üì° Deploy to Server
        uses: appleboy/ssh-action@v1.0.0
        with:
          # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          # –°–∫—Ä–∏–ø—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ Alpine
          script: |
            echo "üîÑ Starting deployment..."
            # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
            cd /opt/utlities
            # –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ –∏–∑ GitHub
            git pull origin main
            echo "‚úÖ Code updated."

            # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if [ -f "package.json" ]; then
              echo "üì¶ Installing npm dependencies..."
              npm install
              echo "‚úÖ Dependencies installed."
            fi

            # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤.
            # –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ PM2:
            # pm2 restart all

            echo "üéâ Deployment successful!"
